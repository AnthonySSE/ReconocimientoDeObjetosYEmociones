<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>App de Análisis de Imágenes – Clasificación, Detección y Sentimientos</title>
  <meta name="description" content="Aplicación web que combina clasificación de imágenes (MobileNet), detección de objetos (COCO-SSD) y análisis de sentimientos de comentarios (USE)">
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="wrap">
    <header>
      <svg aria-hidden="true" width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2l3 6 6 .9-4.5 4.4 1 6.3L12 17l-5.5 2.6 1-6.3L3 8.9 9 8l3-6z" fill="currentColor"/>
      </svg>
      <h1>Analizador de Imágenes + Sentimientos</h1>
      <span class="badge" aria-label="Modelos usados">MobileNet · COCO‑SSD · USE</span>
      <div class="status" id="status" role="status" aria-live="polite"></div>
    </header>

    <main>
      <!-- Panel izquierdo: imagen -->
      <section class="card" aria-labelledby="uploadTitle">
        <div class="hd"><h2 id="uploadTitle">1) Cargar imagen y analizar</h2>
          <div class="actions">
            <label class="filelabel" for="fileInput" title="Elegir archivo">
              <svg aria-hidden="true" width="16" height="16" viewBox="0 0 24 24"><path fill="currentColor" d="M19 15v4H5v-4H3v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-4zM11 7.83V16h2V7.83l2.59 2.58L17 9l-5-5l-5 5l1.41 1.41z"/></svg>
              <span>Subir</span>
            </label>
            <input id="fileInput" type="file" accept="image/*" aria-label="Seleccionar imagen" />
            <button id="analyzeBtn" type="button" disabled title="Analizar imagen (Alt+A)"><span class="kbd">Alt</span>+<span class="kbd">A</span> Analizar</button>
            <button id="clearBtn" type="button" title="Limpiar">Limpiar</button>
          </div>
        </div>
        <div class="bd">
          <div id="dropzone" class="dropzone" tabindex="0" role="button" aria-label="Arrastra y suelta una imagen aquí o presiona para seleccionar">
            <p><strong>Arrastra & suelta</strong> una imagen aquí o haz clic para seleccionar.</p>
            <p class="muted">Formatos comunes (JPG, PNG, etc.). La detección y clasificación se ejecutan en tu navegador.</p>
          </div>
          <div class="canvas-wrap" aria-live="polite">
            <canvas id="canvas" aria-label="Lienzo de imagen analizada"></canvas>
            <div class="legend" id="legend" aria-hidden="true"></div>
          </div>
        </div>
      </section>

      <!-- Panel derecho: resultados y comentarios -->
      <section class="grid2">
        <section class="card" aria-labelledby="resultsTitle">
          <div class="hd"><h2 id="resultsTitle">2) Resultados</h2></div>
          <div class="bd">
            <div class="list" id="clsResults" aria-label="Resultados de clasificación" role="list">
              <div class="muted">Aún sin resultados. Sube una imagen para comenzar.</div>
            </div>
            <hr style="border:none; border-top:1px solid #223253; margin: .9rem 0"/>
            <div class="det" id="detResults" aria-label="Detecciones de objetos" role="list"></div>
          </div>
        </section>

        <section class="card" aria-labelledby="commentTitle">
          <div class="hd"><h2 id="commentTitle">3) Comentarios & Sentimientos</h2></div>
          <div class="bd sentiment">
            <div class="comment-box">
              <label for="comment" class="sr-only">Escribe un comentario sobre la imagen</label>
              <textarea id="comment" placeholder="Escribe tu comentario (analizamos el sentimiento en tiempo real)…" aria-describedby="sentimentDesc"></textarea>
              <div id="sentimentDesc" class="muted">Usamos el Universal Sentence Encoder para estimar la polaridad y emoción predominante (aproximado, no diagnóstico).</div>
              <div class="comment-actions">
                <div class="left">
                  <button id="saveComment" type="button" disabled>Guardar comentario</button>
                  <button id="exportBtn" type="button" title="Exportar historial en JSON">Exportar resultados</button>
                </div>
                <div class="right">
                  <span>Polaridad: <span id="sentScore" class="sent-score">0.00</span></span>
                </div>
              </div>
              <div class="sent-meter"><div id="sentBar"></div></div>
              <div class="chips" id="emotionChips" aria-label="Emociones estimadas"></div>
            </div>
          </div>
        </section>

        <section class="card" aria-labelledby="historyTitle">
          <div class="hd"><h2 id="historyTitle">4) Historial</h2></div>
          <div class="bd">
            <div id="history" class="history" role="list" aria-label="Historial de análisis"></div>
          </div>
        </section>
      </section>
    </main>

    <footer>
      <div>Hecho con <span aria-hidden="true">❤️</span> + TensorFlow.js por Anthony Sánchez.</div>
      <div>Atajos: <span class="kbd">Alt</span>+<span class="kbd">A</span> analizar · <span class="kbd">Alt</span>+<span class="kbd">S</span> guardar comentario</div>
    </footer>
  </div>

  <!-- TensorFlow.js & Modelos -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.20.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder"></script>
  <script src="app.js"></script>
</body>
</html>
